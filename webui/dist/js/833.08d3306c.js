"use strict";(globalThis["webpackChunkfrontend"]=globalThis["webpackChunkfrontend"]||[]).push([[833],{19940:(e,a,l)=>{l.r(a),l.d(a,{default:()=>E});var o=l(59835),t=l(60499),n=l(19302),i=l(73512);const u=(0,o.aZ)({__name:"ConfigFileEditor",props:{modelValue:{},language:{},theme:{}},emits:["update:modelValue"],setup(e,{emit:a}){const l=(0,t.iH)(),n=e,u=a;let c;return(0,o.bv)((()=>{c=i.editor.create(l.value,{value:n.modelValue,language:n.language,theme:n.theme,fontFamily:"Roboto Mono"}),c.onDidChangeModelContent((()=>{const e=c.getValue();u("update:modelValue",e)}))})),(0,o.YP)((()=>n.theme),(e=>c.updateOptions({theme:e}))),(0,o.YP)((()=>n.modelValue),(e=>c.setValue(e))),(e,a)=>((0,o.wg)(),(0,o.iD)("div",{ref_key:"dom",ref:l,class:"editor"},null,512))}});var c=l(11639);const s=(0,c.Z)(u,[["__scopeId","data-v-f81849bc"]]),d=s;var r,v=l(34136),m=l(85300);(function(e){e.RE=/^qdvc:(?<device>(?:[a-zA-Z0-9+/=]|[\u3D00-\u3D08\u4E00-\u8DFF])+)(?:,(?<session>(?:[a-zA-Z0-9+/=]|[\u3D00-\u3D08\u4E00-\u8DFF])+))?$/;const a=e=>/^[a-zA-Z0-9+/=]+$/.test(e);e.decodeBase64=(e,a=!1)=>a?window.atob(e):Uint8Array.from(window.atob(e),(e=>e.charCodeAt(0))),e.encodeBase64=e=>window.btoa(e instanceof Uint8Array?String.fromCharCode(...e):e);const l=(e,a=!1)=>a?(new TextDecoder).decode(m.Jx(e)):m.Jx(e),o=e=>String.fromCharCode(...m.cv(e)),t=(o,t=!1)=>a(o)?e.decodeBase64(o,t):l(o,t);function n(a){const l=e.RE.exec(a);if(!l)return null;const{device:o,session:n}=l.groups;return{device:t(o,!0),session:n?t(n,!1):void 0}}function i(a,l){const{device:t,session:n}=a;return"base64"===l?`qdvc:${e.encodeBase64(t)}${n?`,${e.encodeBase64(n)}`:""}`:`qdvc:${o(t)}${n?`,${o(n)}`:""}`}e.parse=n,e.stringify=i})(r||(r={}));var f=function(e,a,l,o){function t(e){return e instanceof l?e:new l((function(a){a(e)}))}return new(l||(l=Promise))((function(l,n){function i(e){try{c(o.next(e))}catch(a){n(a)}}function u(e){try{c(o["throw"](e))}catch(a){n(a)}}function c(e){e.done?l(e.value):t(e.value).then(i,u)}c((o=o.apply(e,a||[])).next())}))};const p=(0,o._)("div",{class:"text-h5"},"编辑设备信息文件",-1),g={class:"column"},y=(0,o._)("div",{class:"text-body"},[(0,o._)("a",{href:"https://qdvc.ilharp.cc/"},"QDVC"),(0,o.Uk)(" 导入导出 ")],-1),h={class:"q-gutter-md"},w=(0,o._)("div",{class:"text-h6"},"导出 QDVC",-1),b={style:{"max-height":"30vh","font-family":"monospace"}},_=(0,o._)("div",{class:"text-h6"},"导入 QDVC",-1),V={style:{"max-height":"30vh","font-family":"monospace"}},W=(0,o.aZ)({__name:"AccountDeviceEditorView",props:{uin:{}},setup(e){const a=(0,n.Z)(),l=e,i=(0,t.iH)(),u=(0,t.iH)(!0),c=(0,t.iH)(!1),s=(0,t.iH)(!1),m=(0,t.iH)(""),W=(0,t.iH)(!1),C=(0,t.iH)("base64");function D(){return f(this,void 0,void 0,(function*(){try{u.value=!0;const{data:e}=yield v.api.accountDeviceReadApiUinDeviceGet(l.uin);i.value=JSON.stringify(e,null,2)}catch(e){i.value=void 0}finally{u.value=!1}}))}function q(){return f(this,void 0,void 0,(function*(){if(i.value)try{u.value=!0,i.value=JSON.stringify(yield v.api.accountDeviceWriteApiUinDevicePatch(l.uin,JSON.parse(i.value)).then((e=>e.data)),null,2),a.notify({message:"设备信息修改成功",color:"positive"})}catch(e){a.notify({message:`设备信息修改失败: ${e.message}`,color:"negative"})}finally{u.value=!1}}))}function k(){return f(this,void 0,void 0,(function*(){try{u.value=!0,yield v.api.accountConfigDeleteApiUinConfigDelete(l.uin),yield D(),a.notify({message:"设备信息删除成功",color:"positive"})}catch(e){a.notify({message:"设备信息删除失败",color:"negative"})}finally{u.value=!1}}))}function Q(){return f(this,void 0,void 0,(function*(){navigator.clipboard&&(yield navigator.clipboard.writeText(m.value),a.notify({message:"已复制到剪贴板",color:"positive"}))}))}function U(){return f(this,void 0,void 0,(function*(){const e=r.parse(m.value);if(e)try{W.value=!0,e.device&&(yield v.api.accountDeviceWriteApiUinDevicePatch(l.uin,JSON.parse(e.device))),e.session&&(yield v.api.accountSessionWriteApiUinSessionPatch(l.uin,{base64_content:r.encodeBase64(e.session)})),a.notify({message:"设备信息导入成功",color:"positive"})}catch(o){a.notify({message:`设备信息导入失败: ${o.message}`,color:"negative"})}finally{W.value=!1}}))}return(0,o.bv)(D),(0,o.YP)(c,(e=>f(this,void 0,void 0,(function*(){if(e)try{m.value="";const e=yield v.api.accountDeviceReadApiUinDeviceGet(l.uin).then((({data:e})=>JSON.stringify(e))),a=yield v.api.accountSessionReadApiUinSessionGet(l.uin).then((({data:e})=>r.decodeBase64(e.base64_content,!1))).catch((()=>{}));m.value=r.stringify({device:e,session:a},C.value)}catch(o){a.notify({message:`设备信息导入失败: ${o.message}`,color:"negative"})}else m.value=""})))),(0,o.YP)(C,(e=>{const a=r.parse(m.value);m.value=a?r.stringify(a,e):""})),(e,l)=>{const n=(0,o.up)("q-btn"),v=(0,o.up)("q-space"),f=(0,o.up)("q-card-section"),Z=(0,o.up)("q-separator"),x=(0,o.up)("q-input"),A=(0,o.up)("q-btn-toggle"),S=(0,o.up)("q-card-actions"),$=(0,o.up)("q-card"),B=(0,o.up)("q-dialog"),P=(0,o.up)("q-inner-loading"),H=(0,o.up)("q-page");return(0,o.wg)(),(0,o.j4)(H,{class:"row q-pa-md justify-center"},{default:(0,o.w5)((()=>[(0,o.Wm)($,{class:"shadow col-12",style:{height:"calc(100vh - 5rem)"}},{default:(0,o.w5)((()=>[(0,o.Wm)(f,{class:"row items-center"},{default:(0,o.w5)((()=>[(0,o.Wm)(n,{onClick:e.$router.back,flat:"",label:"返回",color:"grey",icon:"arrow_back"},null,8,["onClick"]),p,(0,o.Wm)(v),(0,o._)("div",g,[y,(0,o._)("div",h,[(0,o.Wm)(n,{class:"q-ml-md",onClick:l[0]||(l[0]=e=>s.value=!0),flat:"",round:"",color:"primary",icon:"login"}),(0,o.Wm)(n,{class:"q-ml-md",onClick:l[1]||(l[1]=e=>c.value=!0),flat:"",round:"",color:"secondary",icon:"logout"})])])])),_:1}),(0,o.Wm)(B,{modelValue:c.value,"onUpdate:modelValue":l[4]||(l[4]=e=>c.value=e)},{default:(0,o.w5)((()=>[(0,o.Wm)($,null,{default:(0,o.w5)((()=>[(0,o.Wm)(f,null,{default:(0,o.w5)((()=>[w])),_:1}),(0,o.Wm)(Z),(0,o.Wm)(f,null,{default:(0,o.w5)((()=>[(0,o._)("div",b,[(0,o.Wm)(x,{modelValue:m.value,"onUpdate:modelValue":l[2]||(l[2]=e=>m.value=e),loading:m.value.length<=0,readonly:"",type:"textarea",label:"QDVC分享连接"},null,8,["modelValue","loading"])])])),_:1}),(0,o.Wm)(S,{class:"row justify-center"},{default:(0,o.w5)((()=>[(0,o.Wm)(A,{modelValue:C.value,"onUpdate:modelValue":l[3]||(l[3]=e=>C.value=e),"toggle-color":"secondary",flat:"",options:[{label:"Base64",value:"base64"},{label:"Base16384",value:"base16384"}]},null,8,["modelValue"]),(0,o.Wm)(n,{onClick:Q,flat:"",label:"复制到剪贴板",color:"primary",icon:"content_copy"})])),_:1})])),_:1})])),_:1},8,["modelValue"]),(0,o.Wm)(B,{modelValue:s.value,"onUpdate:modelValue":l[6]||(l[6]=e=>s.value=e)},{default:(0,o.w5)((()=>[(0,o.Wm)($,null,{default:(0,o.w5)((()=>[(0,o.Wm)(f,null,{default:(0,o.w5)((()=>[_])),_:1}),(0,o.Wm)(Z),(0,o.Wm)(f,null,{default:(0,o.w5)((()=>[(0,o._)("div",V,[(0,o.Wm)(x,{modelValue:m.value,"onUpdate:modelValue":l[5]||(l[5]=e=>m.value=e),loading:W.value,disable:W.value,rules:[e=>(0,t.SU)(r).RE.test(e)||"不是有效的 QDVC 链接"],type:"textarea",label:"QDVC分享连接"},null,8,["modelValue","loading","disable","rules"])])])),_:1}),(0,o.Wm)(S,{class:"row justify-center"},{default:(0,o.w5)((()=>[(0,o.Wm)(n,{onClick:U,flat:"",label:"应用 QDVC 配置",color:"primary",icon:"login"})])),_:1})])),_:1})])),_:1},8,["modelValue"]),(0,o.Wm)(Z),(0,o.Wm)(S,{class:"q-gutter-md q-mx-md"},{default:(0,o.w5)((()=>[(0,o.Wm)(n,{flat:"",onClick:q,color:"primary",label:"提交修改",icon:"save"}),(0,o.Wm)(n,{flat:"",onClick:D,color:"secondary",label:"重新加载配置文件",icon:"refresh"}),(0,o.Wm)(n,{flat:"",onClick:k,color:"negative",label:"删除并重新生成配置文件",icon:"delete"})])),_:1}),(0,o.Wm)(f,null,{default:(0,o.w5)((()=>["undefined"!==typeof i.value?((0,o.wg)(),(0,o.j4)(d,{key:0,modelValue:i.value,"onUpdate:modelValue":l[7]||(l[7]=e=>i.value=e),language:"json",style:{height:"70vh"},theme:(0,t.SU)(a).dark.isActive?"vs-dark":"vs"},null,8,["modelValue","theme"])):(0,o.kq)("",!0),(0,o.Wm)(P,{showing:u.value},null,8,["showing"])])),_:1})])),_:1})])),_:1})}}});var C=l(69885),D=l(44458),q=l(63190),k=l(68879),Q=l(90136),U=l(32074),Z=l(50926),x=l(66611),A=l(11821),S=l(78983),$=l(60854),B=l(69984),P=l.n(B);const H=W,E=H;P()(W,"components",{QPage:C.Z,QCard:D.Z,QCardSection:q.Z,QBtn:k.Z,QSpace:Q.Z,QDialog:U.Z,QSeparator:Z.Z,QInput:x.Z,QCardActions:A.Z,QBtnToggle:S.Z,QInnerLoading:$.Z})}}]);